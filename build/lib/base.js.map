{"version":3,"sources":["base.ts"],"names":["ident","TranspilerBase","TranspilerBase.constructor","TranspilerBase.visit","TranspilerBase.emit","TranspilerBase.emitNoSpace","TranspilerBase.reportError","TranspilerBase.visitNode","TranspilerBase.visitEach","TranspilerBase.visitEachIfPresent","TranspilerBase.visitList","TranspilerBase.getAncestor","TranspilerBase.hasAncestor","TranspilerBase.hasAnnotation","TranspilerBase.hasFlag","TranspilerBase.isConst","TranspilerBase.getRelativeFileName","TranspilerBase.maybeVisitTypeArguments"],"mappings":"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","file":"base.js","sourcesContent":["/// <reference path='../node_modules/typescript/bin/typescript.d.ts' />\nimport ts = require('typescript');\nimport ts2dart = require('./main');\n\nexport type ClassLike = ts.ClassDeclaration | ts.InterfaceDeclaration;\n\nexport function ident(n: ts.Node): string {\n  if (n.kind === ts.SyntaxKind.Identifier) return (<ts.Identifier>n).text;\n  if (n.kind === ts.SyntaxKind.QualifiedName) {\n    var qname = (<ts.QualifiedName>n);\n    var leftName = ident(qname.left);\n    if (leftName) return leftName + '.' + ident(qname.right);\n  }\n  return null;\n}\n\nexport class TranspilerBase {\n  constructor(private transpiler: ts2dart.Transpiler) {}\n\n  visit(n: ts.Node) { this.transpiler.visit(n); }\n  emit(s: string) { this.transpiler.emit(s); }\n  emitNoSpace(s: string) { this.transpiler.emitNoSpace(s); }\n  reportError(n: ts.Node, message: string) { this.transpiler.reportError(n, message); }\n\n  visitNode(n: ts.Node): boolean { throw new Error('not implemented'); }\n\n  visitEach(nodes: ts.Node[]) { nodes.forEach((n) => this.visit(n)); }\n\n  visitEachIfPresent(nodes?: ts.Node[]) {\n    if (nodes) this.visitEach(nodes);\n  }\n\n  visitList(nodes: ts.Node[], separator: string = ',') {\n    for (var i = 0; i < nodes.length; i++) {\n      this.visit(nodes[i]);\n      if (i < nodes.length - 1) this.emit(separator);\n    }\n  }\n\n  getAncestor(n: ts.Node, kind: ts.SyntaxKind): ts.Node {\n    for (var parent = n; parent; parent = parent.parent) {\n      if (parent.kind === kind) return parent;\n    }\n    return null;\n  }\n\n  hasAncestor(n: ts.Node, kind: ts.SyntaxKind): boolean { return !!this.getAncestor(n, kind); }\n\n  hasAnnotation(decorators: ts.NodeArray<ts.Decorator>, name: string): boolean {\n    if (!decorators) return false;\n    return decorators.some((d) => {\n      var decName = ident(d.expression);\n      if (decName === name) return true;\n      if (d.expression.kind !== ts.SyntaxKind.CallExpression) return false;\n      var callExpr = (<ts.CallExpression>d.expression);\n      decName = ident(callExpr.expression);\n      return decName === name;\n    });\n  }\n\n  hasFlag(n: {flags: number}, flag: ts.NodeFlags): boolean {\n    return n && (n.flags & flag) !== 0 || false;\n  }\n\n  isConst(decl: ClassLike) {\n    return this.hasAnnotation(decl.decorators, 'CONST') ||\n           decl.members.some((m) => {\n             if (m.kind !== ts.SyntaxKind.Constructor) return false;\n             return this.hasAnnotation(m.decorators, 'CONST');\n           });\n  }\n\n  getRelativeFileName(fileName: string): string {\n    return this.transpiler.getRelativeFileName(fileName);\n  }\n\n  maybeVisitTypeArguments(n: {typeArguments?: ts.NodeArray<ts.TypeNode>}) {\n    if (n.typeArguments) {\n      this.emit('<');\n      this.visitList(n.typeArguments);\n      this.emit('>');\n    }\n  }\n}\n"],"sourceRoot":"/source/"}