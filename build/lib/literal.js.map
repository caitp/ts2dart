{"version":3,"sources":["literal.ts"],"names":["LiteralTranspiler","LiteralTranspiler.constructor","LiteralTranspiler.visitNode","LiteralTranspiler.shouldBeConst","LiteralTranspiler.escapeTextForTemplateString"],"mappings":"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","file":"literal.js","sourcesContent":["/// <reference path='../node_modules/typescript/bin/typescript.d.ts' />\nimport ts = require('typescript');\nimport base = require('./base');\nimport ts2dart = require('./main');\nimport {FacadeConverter} from \"./facade_converter\";\n\nclass LiteralTranspiler extends base.TranspilerBase {\n  constructor(tr: ts2dart.Transpiler, private fc: FacadeConverter) { super(tr); }\n\n  visitNode(node: ts.Node): boolean {\n    switch (node.kind) {\n      // Literals.\n      case ts.SyntaxKind.NumericLiteral:\n        var sLit = <ts.LiteralExpression>node;\n        this.emit(sLit.getText());\n        break;\n      case ts.SyntaxKind.StringLiteral:\n        var sLit = <ts.LiteralExpression>node;\n        var text = JSON.stringify(sLit.text);\n        // Escape dollar sign since dart will interpolate in double quoted literal\n        var text = text.replace(/\\$/, '\\\\$');\n        this.emit(text);\n        break;\n      case ts.SyntaxKind.NoSubstitutionTemplateLiteral:\n        this.emit(`'''${this.escapeTextForTemplateString(node)}'''`);\n        break;\n      case ts.SyntaxKind.TemplateMiddle:\n        this.emitNoSpace(this.escapeTextForTemplateString(node));\n        break;\n      case ts.SyntaxKind.TemplateExpression:\n        var tmpl = <ts.TemplateExpression>node;\n        if (tmpl.head) this.visit(tmpl.head);\n        if (tmpl.templateSpans) this.visitEach(tmpl.templateSpans);\n        break;\n      case ts.SyntaxKind.TemplateHead:\n        this.emit(`'''${this.escapeTextForTemplateString(node)}`);  // highlighting bug:'\n        break;\n      case ts.SyntaxKind.TemplateTail:\n        this.emitNoSpace(this.escapeTextForTemplateString(node));\n        this.emitNoSpace(`'''`);\n        break;\n      case ts.SyntaxKind.TemplateSpan:\n        var span = <ts.TemplateSpan>node;\n        if (span.expression) {\n          // Do not emit extra whitespace inside the string template\n          this.emitNoSpace('${');\n          this.visit(span.expression);\n          this.emitNoSpace('}');\n        }\n        if (span.literal) this.visit(span.literal);\n        break;\n      case ts.SyntaxKind.ArrayLiteralExpression:\n        if (this.shouldBeConst(node)) this.emit('const');\n        this.emit('[');\n        this.visitList((<ts.ArrayLiteralExpression>node).elements);\n        this.emit(']');\n        break;\n      case ts.SyntaxKind.ObjectLiteralExpression:\n        if (this.shouldBeConst(node)) this.emit('const');\n        this.emit('{');\n        this.visitList((<ts.ObjectLiteralExpression>node).properties);\n        this.emit('}');\n        break;\n      case ts.SyntaxKind.PropertyAssignment:\n        var propAssign = <ts.PropertyAssignment>node;\n        if (propAssign.name.kind === ts.SyntaxKind.Identifier) {\n          // Dart identifiers in Map literals need quoting.\n          this.emitNoSpace(' \"');\n          this.emitNoSpace((<ts.Identifier>propAssign.name).text);\n          this.emitNoSpace('\"');\n        } else {\n          this.visit(propAssign.name);\n        }\n        this.emit(':');\n        this.visit(propAssign.initializer);\n        break;\n      case ts.SyntaxKind.ShorthandPropertyAssignment:\n        var shorthand = <ts.ShorthandPropertyAssignment>node;\n        this.emitNoSpace(' \"');\n        this.emitNoSpace(shorthand.name.text);\n        this.emitNoSpace('\"');\n        this.emit(':');\n        this.visit(shorthand.name);\n        break;\n\n      case ts.SyntaxKind.TrueKeyword:\n        this.emit('true');\n        break;\n      case ts.SyntaxKind.FalseKeyword:\n        this.emit('false');\n        break;\n      case ts.SyntaxKind.NullKeyword:\n        this.emit('null');\n        break;\n      case ts.SyntaxKind.RegularExpressionLiteral:\n        this.emit('new RegExp (');\n        this.emit('r\\'');\n        var regExp = (<ts.LiteralExpression>node).text;\n        var slashIdx = regExp.lastIndexOf('/');\n        var flags = regExp.substring(slashIdx + 1);\n        regExp = regExp.substring(1, slashIdx);            // cut off /.../ chars.\n        regExp = regExp.replace(/'/g, '\\' + \"\\'\" + r\\'');  // handle nested quotes by concatenation.\n        this.emitNoSpace(regExp);\n        this.emitNoSpace('\\'');\n        if (flags.indexOf('g') === -1) {\n          // Dart RegExps are always global, so JS regexps must use 'g' so that semantics match.\n          this.reportError(node, 'Regular Expressions must use the //g flag');\n        }\n        if (flags.indexOf('m') !== -1) {\n          this.emit(', multiLine: true');\n        }\n        if (flags.indexOf('i') !== -1) {\n          this.emit(', caseSensitive: false');\n        }\n        this.emit(')');\n        break;\n      case ts.SyntaxKind.ThisKeyword:\n        this.emit('this');\n        break;\n\n      default:\n        return false;\n    }\n    return true;\n  }\n\n  private shouldBeConst(n: ts.Node): boolean {\n    return this.hasAncestor(n, ts.SyntaxKind.Decorator) || this.fc.isInsideConstExpr(n);\n  }\n\n  private escapeTextForTemplateString(n: ts.Node): string {\n    return (<ts.StringLiteral>n).text.replace(/\\\\/g, '\\\\\\\\').replace(/([$'])/g, '\\\\$1');\n  }\n}\n\nexport = LiteralTranspiler;\n"],"sourceRoot":"/source/"}